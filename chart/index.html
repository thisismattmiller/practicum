<?php


	require_once('include.php');
	$project = new Chart;

	if (isset($_REQUEST['address'])){
	
			header("content-type: application/json");
			
			$_REQUEST['address']=str_replace(" ","+",$_REQUEST['address']);
			$data = file_get_contents('http://maps.googleapis.com/maps/api/geocode/json?address=' . $_REQUEST['address'] . '+near+brooklyn+NY&sensor=false');				
	
			echo $data;
			exit();
	}
	
	if (isset($_REQUEST['toDoCount'])){		
		header("content-type: application/json");	
		$toDoCount = $project->returnToDoImageCount();	
		echo $toDoCount;
		exit();		
	}


	if (isset($_REQUEST['toDoImages'])){		
		header("content-type: application/json");	
		$toDoCount = $project->returnToDoImages();	
		echo $toDoCount;
		exit();		
	}
	
	if (isset($_REQUEST['returnImages'])){		
		header("content-type: application/json");	
		$toDoCount = $project->returnImages();	
		echo $toDoCount;
		exit();		
	}	
	
	if (isset($_REQUEST['returnNotes'])){		
		header("content-type: application/json");	
		$notes = $project->returnNotes($_REQUEST['returnNotes']);	
 		exit();		
	}	
	if (isset($_REQUEST['returnUserImages'])){		
		header("content-type: application/json");	
		$notes = $project->returnUserImages($_REQUEST['returnUserImages']);	
 		exit();		
	}	

	
	

	if (isset($_REQUEST['lat']) && isset($_REQUEST['lng']) && isset($_REQUEST['id'])){		
		header("content-type: application/json");	
		$toDoCount = $project->savePlacement($_REQUEST['id'],$_REQUEST['lat'],$_REQUEST['lng']);	
		exit();		
	}

	if (isset($_REQUEST['lat']) && isset($_REQUEST['lng']) && isset($_REQUEST['max'])){		
		header("content-type: application/json");	
		$project->returnNearByMarkers($_REQUEST['lat'],$_REQUEST['lng'],$_REQUEST['max']);	
		exit();		
	}	
	
	
	
	

	if (isset($_REQUEST['pov']) && isset($_REQUEST['id'])){		
		header("content-type: application/json");	
		$toDoCount = $project->savePov($_REQUEST['id'],$_REQUEST['pov']);	
		exit();		
	}	

	if (isset($_REQUEST['note']) && isset($_REQUEST['id'])){		
		header("content-type: application/json");	
		$toDoCount = $project->saveNote($_REQUEST['id'],$_REQUEST['note']);	
		exit();		
	}	
	
	if (isset($_REQUEST['removeItemFromMap'])){		
		header("content-type: application/json");	
		$toDoCount = $project->removeItemFromMap($_REQUEST['removeItemFromMap']);	
		exit();		
	}		



?>



<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="X-UA-Compatible" content="IE=8;FF=3;OtherUA=4" />



<link type="text/css" href="css/flick/jquery-ui-1.8.10.custom.css" rel="Stylesheet" />

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.10.custom.min.js"></script>


<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0px; padding: 0px; font-family:Arial, Helvetica, sans-serif;}
  #map_canvas { height: 100% }
  #todoBox{ position:absolute; top:35px; right:7px; z-index:1000; height:90%; width:250px;
  			-moz-box-shadow: 3px 3px 4px #666;-webkit-box-shadow: 3px 3px 4px #666;box-shadow: 3px 3px 4px #666;/* For IE 8 */-ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#666666')";/* For IE 5.5 - 7 */filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#666666');
			background-position:top;
			visibility:hidden; 
			
  
  }
  
  
  .infoWindowLock{text-align:center; font-size:14px;}
  #toolBar { padding: 5px 2px; position:absolute; top:20px; left:75px; z-index:1000; font-size:12px; 
  
		-moz-box-shadow: 3px 3px 4px #666;-webkit-box-shadow: 3px 3px 4px #666;box-shadow: 3px 3px 4px #666;/* For IE 8 */-ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#666666')";/* For IE 5.5 - 7 */filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#666666');
  
  
  }  
  #searchBox{ position:absolute; top:80px; left: 75px; z-index:1000; height:185px; width:325px;
  			-moz-box-shadow: 3px 3px 4px #666;-webkit-box-shadow: 3px 3px 4px #666;box-shadow: 3px 3px 4px #666;/* For IE 8 */-ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#666666')";/* For IE 5.5 - 7 */filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#666666');
			background-position:top;
			visibility:hidden;
  			
  
  }
  #filterBox{ position:absolute; top:80px; left: 75px; z-index:1000; width:325px;
  			-moz-box-shadow: 3px 3px 4px #666;-webkit-box-shadow: 3px 3px 4px #666;box-shadow: 3px 3px 4px #666;/* For IE 8 */-ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#666666')";/* For IE 5.5 - 7 */filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#666666');
			background-position:top;
			visibility:hidden;

  			
  
  }  
  
  
  #previewBox{ position:absolute; z-index:1000; height:310px; width:380px;
  			-moz-box-shadow: 3px 3px 4px #666;-webkit-box-shadow: 3px 3px 4px #666;box-shadow: 3px 3px 4px #666;/* For IE 8 */-ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#666666')";/* For IE 5.5 - 7 */filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#666666');
			background-position:top;
			visibility:hidden;
  			
  
  }  
  #previewBoxImage{width:380px; background-position:center; background-repeat:no-repeat; background-color:#000; height:310px;}
  #previewBoxTitle{width:380px; text-align:center; height:65px; position:absolute; bottom:0px;  overflow:hidden; background:transparent url(img/trans_25.png) repeat;}
  
  #previewBoxClose{position:absolute; right:0px; bottom:0px; color:#000; text-decoration:none;}
  
  
  
  #formSearch_text{font-size:18px; border:none; width:320px; margin:2px; margin-top:5px;}
  
  #searchBox li{font-style:oblique;}	
  #searchBox div{margin:10px;}	
  #searchBox button{font-size:12px;}
  
  
  
  #todoBoxImages img{margin:3px; cursor:pointer;}
  #todoBoxImages{overflow:auto; max-height:92%; height:92%; background-color:#000; color:#FFF;}

  .todoBoxInstruction{
	  font-size:12px;
	  text-align:center;
	  margin:2px;
	  
	  
  }
  .todoBoxImagesHeader{
	  color:fff#;
	  font-size:14px;
  }

  #filterBox button{font-size:12px;}

  #filterBoxTitleList li{
	  cursor:pointer;
	  margin-bottom:2px;
	    
  
  }
  #filterBoxTitleList li:hover{
	  color:#06C;  
  }
  
  .liCheck{
	  background-image: url(img/li_check.png);
	  background-position: center left;
	  background-repeat: no-repeat;
	  padding-left: 25px;
	  padding-top: 2px;	  
	  list-style: none;	  	  
  }
  .liX{
	  background-image: url(img/li_x.png);
	  background-position: center left;
	  background-repeat: no-repeat;
	  padding-left: 25px;
	  padding-top: 2px;	
	  list-style: none;	  	  
  }  
  .ui-dialog-titlebar{
	  padding:0em !important;

  }
  
  #modalDetailDialog{
	  position:relative;
	  background-color:#F9F9F9;
	  
  }

  #modalPano{
	  height:200px;
	  width:200px;
	  position:absolute;
	  left:9px;
	  top:8px;
	  
	  z-index:10000;
 
  }
  
  #streetViewControlsStart, #streetViewControlsEdit, #streetViewControlsPresent{
	  display:none;
	  width:500px;
	  min-width:500px;   
  }
  #streetViewTitle{
	  text-align:justify;
  }
  #streetViewMetaHolder{
	  float:left;
 	  height:465px;
	  overflow:auto;
	  position:relative;
	  
	  
  }
  
  #addNoteHolder{
	  position:absolute;
	  background-color:#fff;
	  top:0px;
	 
	  height:400px;
	  display:none;	  
  }
  
  .streetViewNotesHolderNote{
	  font-size:0.6em;
	  margin-top:15px;
	  
  }
  /*
  .filterButtonHolder .ui-button-icon-primary,  .filterButtonHolder .ui-icon{
	  top: 0px !important;
	  height:50px !important;
  }
  */
  #filterButtonHolder, #addButtonHolder,#searchButtonHolder{
	  height:40px;	  
  }
  
  .customIconFilter{
            background-image: url(img/filter.png) !important;
			left:10px;
			width:28px;
			height:30px;
			margin-top: -14px !important; 
  }

  .customIconAdd{
            background-image: url(img/addImage.png) !important;
			left:10px;
			width:32px;
			height:32px;
			margin-top: -16px !important; 
  }  
  
  .customIconSearch{
            background-image: url(img/search.png) !important;
			left:10px;
			width:32px;
			height:32px;
			margin-top: -16px !important; 
  }  
  
  
  .ui-state-active{
	  
	  border: 1px solid #0073ea !important; 
	  background: #0073ea url(css/flick/images/ui-bg_highlight-soft_25_0073ea_1x100.png) 50% 50% repeat-x !important;
	  
	  
  }
  
  .ui-slider-handle{
	  border: 1px solid #0073ea !important; 
	  background: #0073ea url(css/flick/images/ui-bg_highlight-soft_25_0073ea_1x100.png) 50% 50% repeat-x !important;	  
  }
  
  
	#filterBoxHideAll{
		
		margin:5px;
		cursor:pointer;
		
	}

  
</style>

<script type="text/javascript"
    src="http://maps.google.com/maps/api/js?sensor=false">
</script>


<script type="text/javascript">
/*
	var toDoCount = <?=$toDoCount?>;
*/
</script>


<script type="text/javascript">


chartDemo = {
	
	//google maps  - general
	googleMap : null,			//holds the defined google map
	googlePanorama : null,		//holds the panorama object created for the streeviews
	allowedBounds: null,		//keeps track of the allowed max postions on the map, inilized in iniializeGoogle
	currentLat: null,			//stores the location of the mouse on the map
	currentLng: null,			//''
	
	//google maps - markers
	allMarkers: new Array(),	//holds an array of all the markers added to the google map
	markerSize: null,			//holds the base size of the marker in an google.maps.Size object
	markerAnchor: null,			// "" in a google.maps.Point
	infowindowLockMarker: null,	//the info window lock marker template
	
	markerDataId: null,			//these are all used to hold data when adding markers to the map from storage and in realtime
	markerDataNotes: null,
	markerDataIsNew: null,
	markerDataPano: null,
	markerTemp: null,			//holds a tempoary marker used in things like the search feature
	markerActive: null,			//holds the active marker, the one up on the detail window or other mono view situtations
	
	markerFading: false,			//is the preview window activvtly fading, if it is don't start a new one until the animation is done
	
	markerClearkOfLightbox: false,	//used to track when the marker leaves the todo image list box
	
	
	
	//*********************************************************
	//initialize the map and assigns all the google events etc.
	//*********************************************************
	initializeGoogle: function(){
		
		
		//holds the starting point
		var startingPoint = new google.maps.LatLng(40.6511, -73.9490);
		
		var mapOptions = {
		  zoom: 13, //starting zoom
		  center: startingPoint, //center of brooklyn
		  mapTypeId: google.maps.MapTypeId.ROADMAP,
		  minZoom: 13 //don't let them zoom out anymore than this
		};		
		
		//initialize map to the map_canvas dom element
		this.googleMap = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
		
	 
		
		
		//this builds the limts to the google map, used later if the user scrolls outsize the brooklyn area
		var southWestLimit = new google.maps.LatLng(40.5562, -74.0583);
		var northEastLimit = new google.maps.LatLng(40.7064, -73.8566);		
		this.allowedBounds = new google.maps.LatLngBounds(southWestLimit, northEastLimit);

	
		//inital size of the markers
		this.markerSize= new google.maps.Size(50, 50);
		this.markerAnchor= new google.maps.Point(15, 30);			
			
			
		//define the info window template they see when placing a marker	
		this.infowindowLockMarker = new google.maps.InfoWindow({
			content: '<div class="infoWindowLock">Click and drag again to get the <br />location just right (try zooming in).<br />When you are finished:<br /><input type="button" value="Click to Lock Location" onclick="chartDemo.mapLockMarkers(); return false;"/></div>'
		});			
		
		
		
		//Google maps event listeners

	
	   //Add a move listener to restrict the bounds range
		google.maps.event.addListener(this.googleMap, 'idle', function() {
			chartDemo.mapCheckBounds();
		});			

		
		//add listener to resize things when the map zooms in and out
		google.maps.event.addListener(this.googleMap, 'zoom_changed', function() {
			chartDemo.mapUpdateZoom();
		});		
		
		
		//keeps track of where the mouse is at
		google.maps.event.addListener(this.googleMap, 'mousemove', function(mEvent) {
 			chartDemo.currentLat=mEvent.latLng.lat();
			chartDemo.currentLng=mEvent.latLng.lng();			
		});			
		
		

		
	},
	//End initializeGoogle
	
	
	
	
	//*********************************************************
	//checks the position of the map after change to make sure we are still looking at the brooklyn area
	//*********************************************************
	mapCheckBounds: function(){	
	
		// Perform the check and return if OK
		if (this.allowedBounds.contains(this.googleMap.getCenter())) {
		  return;
		}	
		
		// It`s not OK, so find the nearest allowed point and move there
		var C = this.googleMap.getCenter();
		var X = C.lng();
		var Y = C.lat();
	
		var AmaxX = this.allowedBounds.getNorthEast().lng();
		var AmaxY = this.allowedBounds.getNorthEast().lat();
		var AminX = this.allowedBounds.getSouthWest().lng();
		var AminY = this.allowedBounds.getSouthWest().lat();
	
		if (X < AminX) {X = AminX;}
		if (X > AmaxX) {X = AmaxX;}
		if (Y < AminY) {Y = AminY;}
		if (Y > AmaxY) {Y = AmaxY;}
		this.googleMap.setCenter( new google.maps.LatLng(Y,X));	
	
	},
	//end mapsCheckBounds
	
	//*********************************************************
	//fired when the map is zoomed in/out, we need to update the size of the markers on display
	//*********************************************************
	mapUpdateZoom: function(){	
	 
	
		//set the zoom level that will tell new markers how big to be
				
		if (this.googleMap.zoom==13){
			
			var size = 50;

			
		}else if (this.googleMap.zoom==14){
			
			var size = 70;
			
			
		}else if (this.googleMap.zoom==15){
			
			var size = 80;
			
			
		}else if (this.googleMap.zoom==16){
			
			var size = 90;
			
			
		}else if (this.googleMap.zoom==17){
			
			var size = 130;
			
			
		}else if (this.googleMap.zoom==18){
			
			var size = 160;
			
			
		}else if (this.googleMap.zoom==19){
			
			var size = 180;
			
			
		}
		
		this.markerSize= new google.maps.Size(size, size);
		this.markerAnchor= new google.maps.Point(size/2,size);		
			
	
		
		//update the sizes 
		var arLen=this.allMarkers.length;
		for ( var i=0, len=arLen; i<len; ++i ){
			
			//remake the image with the new size and 
			var image = new google.maps.MarkerImage('img/'+ this.allMarkers[i].dataId +'_ring.png',
			  this.markerSize,
			  // The origin for this image is 0,0.
			  new google.maps.Point(0,0),
			  // The anchor for this image is the base/middle of image
			  this.markerAnchor,
			  //scale image
			  this.markerSize);				
				
			
			this.allMarkers[i].icon=image;
			this.allMarkers[i].animation=null;
			this.allMarkers[i].setMap(this.googleMap);
		}			
		
	 
	 
	
	},
	//end mapUpdateZoom	


	//*********************************************************
	// add a marker to the map 
	//*********************************************************
	mapAddMarkerToCurrentPos: function(){	
 

	  //rough location based off of the mouse
	  var location = new google.maps.LatLng(this.currentLat,this.currentLng);	
	  var titleShort=this.utilityFilterNotesIntoTitle(this.markerDataNotes);
	   
	   
	  //are we loading a marker from storage or is it a new one  
	  if (this.markerDataIsNew){	
		var isVisible = true; 
		var isDraggable = true; 		  
	  }else{
		var isVisible = false;		
		var isDraggable = false;		  
	  }
	  
	  
	  var image = new google.maps.MarkerImage('img/'+this.markerDataId+'_ring.png',
		  chartDemo.markerSize,
		  // The origin for this image is 0,0.
		  new google.maps.Point(0,0),
		  // The anchor for this image is the base/middle of image
		  chartDemo.markerAnchor,
		  //scale image
		  chartDemo.markerSize);
		
		/*
		console.log(this.markerDataIsNew);
		console.log(this.markerDataId);
		console.log(this.markerDataNotes);
		console.log(this.titleShort);
		console.log(this.markerDataPano);	
		console.log(isVisible);								
		console.log(isDraggable);										
		*/
	  	
		marker = new google.maps.Marker({
			map:this.googleMap,
			draggable: isDraggable,
			animation: google.maps.Animation.DROP,
			position: location,			
			visible: isVisible,
			icon: image,
			title: '(Click For More)',
			dataId: this.markerDataId,
			dataTitle: this.markerDataNotes,
			dataTitleShort:titleShort,
			dataPano: this.markerDataPano
		});
  

		//display the lock window infowindow box if this a new one
  		if (this.markerDataIsNew){
			this.infowindowLockMarker.open(this.googleMap,marker);
		}

		//add it to the array of markers
		this.allMarkers.push(marker);

		
		
		google.maps.event.addListener(marker, 'mouseover', function() {
			 
			chartDemo.displayTogglePreviewImage(true,this);
		 
		});	
		google.maps.event.addListener(marker, 'mouseout', function() {
			chartDemo.displayTogglePreviewImage(false,this);
		});	
		
		google.maps.event.addListener(marker, 'click', function() {			
		 	chartDemo.displayOpenDetailWindow(this);		
		});			
		
		//clear out the data just incase 
		chartDemo.currentLat = null;
		chartDemo.currentLng = null;
		chartDemo.markerDataNotes = null;
		chartDemo.markerDataPano = null;
		chartDemo.markerDataId = null;
		chartDemo.markerDataIsNew = null;
		
		
	 
	
	},
	//end  	mapAddMarkerToCurrentPos
	

	//*********************************************************
	//adds the markers that are in storage, recalled from the server via ajax
	//*********************************************************
	mapAddPlacedMarkers: function(){	
	

		$.get("?", { "returnImages": true},
			function(data){
 
				var title='';
				var oldTitle='';
				
				//clear out the old list
				$('#filterBoxTitleList').empty();

				for (aImage in data)
				{	
					title = chartDemo.utilityFilterNotesIntoTitle(data[aImage].notes);
					 
					if (title!=oldTitle){
						//add it to the list
						$('#filterBoxTitleList').append(
							$('<li>')
								.text(title)
								.addClass('filterListItem')
								.addClass('liX')								
								.attr('title','Click to toggle diplay on map')								
								.data('title',title)
								.click(function(){chartDemo.displayToggleListItem($(this))}) 
						);
						
					}
	
 					//store the data
					chartDemo.currentLat = data[aImage].lat;
					chartDemo.currentLng = data[aImage].lng;					
					chartDemo.markerDataNotes = data[aImage].notes;
					chartDemo.markerDataPano = data[aImage].pov;
					chartDemo.markerDataId = data[aImage].museId;						
					chartDemo.markerDataIsNew = false;
	 
	
					chartDemo.mapAddMarkerToCurrentPos();			
										
					oldTitle=title;
		
				}
				 
				//what gets displayed by defult?
				$('.filterListItem').each(function(index) { 

					//all
					$(this).click();

					//if ($(this).data('title').toLowerCase() == 'brooklyn residences'){
					
					//}
				
				
				});						
				
				chartDemo.mapUpdateZoom(); //resize the markers 			
				
		}, "json");	
		 
	
	},
	//end  	mapAddPlacedMarkers
	
	
	
	//*********************************************************
	//filter out the markers by folder name
	//*********************************************************
	mapFilterMarkers: function(useTitle,display){	
	 
		
		var arLen=this.allMarkers.length;
		for ( var i=0, len=arLen; i<len; ++i ){
			
			if (this.allMarkers[i].dataTitleShort == useTitle){
				this.allMarkers[i].setAnimation(null);			
				this.allMarkers[i].setVisible(display);
			}
		}			
	},
	//end  	mapFilterMarkers	
	

	//*********************************************************
	//locks all the markers on the map, used if another marker is added without locking the previous addtion
	//*********************************************************
	mapLockMarkers: function(){	
	  		
		//close the infobox that is probablly open
		this.infowindowLockMarker.close();

		var arLen=this.allMarkers.length;
		for ( var i=0, len=arLen; i<len; ++i ){

		  if (this.allMarkers[i].draggable){
			//this one is not saved yet because it can be dragged  
			 
			 this.utilitySaveMarker(this.allMarkers[i].dataId,this.allMarkers[i].getPosition().lat(),this.allMarkers[i].getPosition().lng());
			  
			  
			  
		  }
			
		  this.allMarkers[i].draggable=false;
		  this.allMarkers[i].setMap(this.googleMap)
		  
		   
		  
		}				
	},
	//end  	mapLockMarkers		
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

	//*********************************************************
	//makes the stored ttitle into something more human readable
	//*********************************************************
	utilityFilterNotesIntoTitle: function(notes){	


		notes = notes.substring(notes.search(/\./)+1);
		notes = notes.substring(0, notes.search(/View/));
		notes = notes.replace('S., ','');
		notes = notes.replace(/\./g,'');
		notes = notes.replace(/brooklyn brooklyn/ig,'Brooklyn');					
		notes = notes.replace('  ',' ');					
		notes = notes.replace(/^\s+|\s+$/g, '');		
		notes = notes.replace('Brooklyn,','Brooklyn');							
		
		
		return notes;	 
	
	},
	//end utilityFilterNotesIntoTitle 
	
	
	
	
	//*********************************************************
	//rreturns user images
	//*********************************************************
	utilityreturnUserImages: function(useId){	
	
	
		$('#userImagesHolder').empty();
		
		$.get("http://thisismattmiller.com/chart/", { "returnUserImages": useId},
			function(data){				
				 
				 
				
				 
				 
				for (aImage in data)
				{
					

				 
				 
				 	$('#userImagesHolder').append(
						$('<img>')
							.attr('src','img/users/' + data[aImage].filename)
							.attr('height', '75')
							.data('id',useId)
							.css('cursor','pointer')
							.attr('alt','Click to view uploaded photo')
							.attr('title','Click to view uploaded photo')							
							.data('filename',data[aImage].filename)	
							.click(function() {							
							
							 
								$('#modalPanoHolder').empty();
									
								$('#modalPanoHolder').append(
									$('<div>')
										.attr('id','modalPano')
										.append(
											$('<img>')
												.attr('src','img/users/' + $(this).data('filename'))
													
										)
										
										
										
								);		
								
								$('#modalPano img').css('height', $('#modalLargeImage img').outerHeight());
								$('#modalPano img').css('width', $('#modalLargeImage img').outerWidth());						
								
								$('#streetViewControlsStart').css('display','none');		
								$('#streetViewControlsPresent').css('display','none');		
								$('#streetViewControlsEdit').css('display','none');								

								$('#modalPano').fadeTo('fast', 75);
								$( "#streetViewPresentSlider" ).slider( "option", "value", 75 );
								$('#streetViewControlsPresent').css('display','block');										
													
							 
							})
					
					);
				 
					 //.addClass('streetViewNotesHolderNote')		
					
				
				}
				
			}); 
	},	
		
	
	
	//*********************************************************
	//returns the data add to the record
	//*********************************************************
	utilityReturnNotes: function(useId){	
	
		$.get("http://thisismattmiller.com/chart/", { "returnNotes": useId},
			function(data){				
				 
				 
				$('#streetViewNotesHolder').empty();
				 
				 
				for (aNote in data)
				{		
				 
					var note = data[aNote].note;
					note = note.replace(/&#39;/g,"'");
					note = note.replace(/&#34;/g,'"');
					note = note.replace(/&quot;/gi,'"');								
					
					
					$('#streetViewNotesHolder').append(
						$('<div>')
							.text(note)
							.addClass('streetViewNotesHolderNote')
							.data('id',useId) 
											
					
					);
					
				
				}
				
			}); 
	},	
	


	
	//*********************************************************
	//sends off the POV data to store in DB
	//*********************************************************
	utilitySavePOV: function(id,pov){	 
		$.get("http://thisismattmiller.com/chart/", { "id": id, "pov" : pov},
			function(data){				
			
			
		}, "json");
		//also update the marker of the current one was just sent to the server
		var arLen=this.allMarkers.length;
		
		for ( var i=0, len=arLen; i<len; ++i ){ 
			if (this.allMarkers[i].dataId == id){
				this.allMarkers[i].dataPano = pov;			
				$( "#modalDetailDialog" ).dialog("close"); 				
			}
		}	
	},
	//end  utilitySavePOV
	
	//*********************************************************
	//sends off the marker placment data
	//*********************************************************
	utilitySaveMarker: function(id,lat,lng){	 
 
		$.get("http://thisismattmiller.com/chart/", { "id": id, "lat" : lat, "lng" : lng},
			function(data){
				
		}, "json");		  
	   		
 
	},
	//end  utilitySaveMarker
		
	
	
	
	//*********************************************************
	//Submits a search query to the google api to try and locate a place on the map
	//*********************************************************
	utilitySearchMap: function(){	


		var searchVal = $('#formSearch_text').val().replace(/^\s+|\s+$/g, '');

		//did they just enter a lat lng pos?
		var matches= searchVal.match(/([0-9.-]+).+?([0-9.-]+)/);
 
 	
		if (matches==null){
			//nope ask google where it is

		
			//send the ajax to the server that then sends it to google because of cross domain request
			$.get("http://thisismattmiller.com/chart/", { "address": searchVal, "sensor" : "false" },
				function(data){
					 
	
					if (data.status!='OK'){
						alert('Sorry, could not find that');
						return false;					
					}
					
					 
					//just grab the first result
					var lat = data.results[0].geometry.location.lat;
					var lng = data.results[0].geometry.location.lng;				
					
					//some weird black hole spot it goes to if it cannot find it
					if (lat == 40.6500000 && lng == -73.9500000){
						alert('Sorry, could not find that');
						return false;						
					}
			
					var resultLocation = new google.maps.LatLng(lat,lng);
					if (chartDemo.allowedBounds.contains(resultLocation)){					
									//it is so center the map on that spot
									
							chartDemo.googleMap.panTo(resultLocation);
							if (chartDemo.googleMap.zoom<15){
								chartDemo.googleMap.setZoom(15);
							}
							
							//throw a temp marker on it to grab thier attention
							chartDemo.markerTemp = new google.maps.Marker({
								map:chartDemo.googleMap,
								draggable:false,
								animation: google.maps.Animation.BOUNCE,
								position: resultLocation
							});					
							//remove it after 3 secs
							setTimeout(function(){ 		chartDemo.markerTemp.setMap(null);  }, 3000);
							
							
					}else{
					
						alert('Sorry, Could not find that in the Brooklny Area');	
						
					}						
					
			}, "json");	
	
	
		}else{
			
			//they have lat lng, check if its in the area and if soo goto	
			var lat=parseFloat(matches[1]);
			var long=parseFloat(matches[2]);					
			
			var resultLocation = new google.maps.LatLng(lat,long);
			if (chartDemo.allowedBounds.contains(resultLocation)){					
							//it is so center the map on that spot
							
					chartDemo.googleMap.panTo(resultLocation);
					if (chartDemo.googleMap.zoom<15){
						chartDemo.googleMap.setZoom(15);
					}
					
					//throw a temp marker on it to grab thier attention
					chartDemo.markerTemp = new google.maps.Marker({
						map:chartDemo.googleMap,
						draggable:false,
						animation: google.maps.Animation.BOUNCE,
						position: resultLocation
					});					
					//remove it after 3 secs
					setTimeout(function(){ 		chartDemo.markerTemp.setMap(null);  }, 3000);
					
					
			}else{
			
				alert('Sorry, Could not find that in the Brooklny Area');	
				
			}				
			
		}
		 
		
	
		return false;
				
	},		
	
	
		
	
	
	
	//*********************************************************
	//toggles the preview window in the coner of the screen on mouseover
	//*********************************************************
	displayTogglePreviewImage: function(display, marker){	
			if (display){
				  
				$('#previewBox').css('visibility','visible');		 
				if (this.markerFading){return false;} 
				this.markerFading=true;
				
				$('#previewBox').fadeIn(50,function() {
					 chartDemo.markerFading=false;
				});
				
				$("#previewBoxImage").css('background-image','url(' + 'img/' + marker.dataId + '_medium.jpg'  + ')');
				$("#previewBoxTitle").text(marker.dataTitle);	 				
				 
			}else{ 
				//this.markerOverCount=this.markerOverCount-1;		 
				$('#previewBox').fadeOut(10); 
			} 
	},
	//end  displayTogglePreviewImage		
	
	
	
	
	
	
	
	
	//*********************************************************
	//opends the display window when a marker is clicked on its holds the street view if it exists
	//*********************************************************
	displayOpenDetailWindow: function(marker){	
	
		//store a ref in the object
		this.markerActive = marker;
		
		
		//the text jumps around a bit so hid it until things are better situated
		$('#streetViewMetaHolder').css('visibility','hidden');	
 
						
		
		
		$('#modalLargeImage').empty();
		$('#modalPanoHolder').empty();
		
		$('#modalPanoHolder').append(
			$('<div>')
				.attr('id','modalPano')
		);
		
		
		//set up the google street view
		
		
		//what is the streetview status? 
		$('#streetViewControlsStart').css('display','none');		
		$('#streetViewControlsPresent').css('display','none');		
		$('#streetViewControlsEdit').css('display','none');		
		
				
		if (marker.dataPano==''){
			
			//this is a new street view, just point it in the right lat lng
			
			$('#streetViewControlsStart').css('display','block');		
			var panoramaOptions = {
			  position: marker.position,
			  addressControl: true,
			  linksControl: true,
			  visible: false
			};			
			
				
		}else{
			 
			
			//we have aall the POV data stored, break it out and setup the panorama
			
			var temp = new Array();
			temp = marker.dataPano.split(',');			
			
			var lat = parseFloat(temp[0]);
			var lng = parseFloat(temp[1]);			
			var heading = parseFloat(temp[2]);
			var pitch = parseFloat(temp[3]);
			var zoom = parseFloat(temp[4]);						
			
			var position = new google.maps.LatLng(lat,lng);
			 				 
			var panoramaOptions = {
			  position: position,
			  addressControl: false,
			  linksControl: false,
			  panControl: false,
			  zoomControl: false,
			  visible: true,
			  pov: {
				heading: heading,
				pitch: pitch,
				zoom: zoom
			  }			  
			  
			};			 
			
			$('#modalPano').fadeTo('fast', 0);
			$( "#streetViewPresentSlider" ).slider( "option", "value", 0 );
			$('#streetViewControlsPresent').css('display','block');		
			
			
			
			
		}

		this.googlePanorama = new google.maps.StreetViewPanorama(document.getElementById("modalPano"),panoramaOptions);
		
		
		
		  
		
		
		$('#modalLargeImage').append(
			$("<img>")
				.attr('src','img/'+marker.dataId+'_large.jpg')
				.css('width','auto')
				.css('height','425px')
				.attr('id','modalLargeImageImg')
				.load(function () {
					
					
					//alert($('#modalLargeImage img').attr('offsetWidth'));
					
					$('#modalPano').css('height', $('#modalLargeImage img').outerHeight());
					$('#modalPano').css('width', $('#modalLargeImage img').outerWidth());	
					$('#streetViewControlsStart').css('width', $('#modalLargeImage img').outerWidth());				
					$('#streetViewControlsEdit').css('width', $('#modalLargeImage img').outerWidth());				
					$('#streetViewControlsPresent').css('width', $('#modalLargeImage img').outerWidth());								
					$('#streetViewImageHolder').css('width', $('#modalLargeImage img').outerWidth()+5);													
										
					var remainder = 860 - $('#modalLargeImage img').outerWidth();
					$('#streetViewMetaHolder').css('width', remainder);
					
					
					$('#streetViewPresentSlider').css('width', $('#modalLargeImage img').outerWidth()/2);
					$('#streetViewPresentSliderHolder').css('width', $('#modalLargeImage img').outerWidth()/2);					
					
					
																		
					 										
										
					//alert($('#modalLargeImage img').outerHeight());
					//$('#modalPano').css('left','17px');
					//$('#modalPano').css('top','7px');	
								
					 

			 
					google.maps.event.trigger(chartDemo.googlePanorama, 'resize');											
					$('#streetViewMetaHolder').css('visibility','visible');						
 
					
				})
				.each(function(){
					if(this.complete){ $(this).trigger("load");}
				})
		
		
		
		);
			 

		//get any notes
		$('#streetViewNotesHolder').empty();
		this.utilityReturnNotes(marker.dataId);
		
		this.utilityreturnUserImages(marker.dataId);
		
		 
			  
		 

		$('#modalPano').css('height', $('#modalLargeImage img').outerHeight());
		$('#modalPano').css('width', $('#modalLargeImage img').outerWidth());			
		google.maps.event.trigger(this.googlePanorama, 'resize');											
		


		
		//map.setStreetView($.panorama);			
		
		$('#streetViewTitle').html(marker.dataTitle +  '<a target="_blank" href="http://www.brooklynmuseum.org/opencollection/archives/image/' + marker.dataId + '/"><img border="0" src="img/bm.png"/></a>');

		  
		
		$( "#modalDetailDialog" ).dialog( "option" , "title" , marker.dataTitleShort);
		
		$( "#modalDetailDialog" ).dialog( "open" );
		$( "#addNoteButtonNvm" ).click();
		
		   
		
		
		$('#streetViewControlsStart').css('width', $('#modalLargeImage img').outerWidth());				
		$('#streetViewControlsEdit').css('width', $('#modalLargeImage img').outerWidth());				
		$('#streetViewControlsPresent').css('width', $('#modalLargeImage img').outerWidth());								
		$('#streetViewImageHolder').css('width', $('#modalLargeImage img').outerWidth()+5);													

		var remainder = 860 - $('#modalLargeImage img').outerWidth();
		$('#streetViewMetaHolder').css('width', remainder);		




		
		//ME PUNCHING INTERNET EXPLORER IN THE FACEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE
		/*
		
		　　　　　　　　　　　　　　　　.　-―- 　.
		　　　　　　　　　　　　　　,. '´　　　　　　｀''ー-　 ､
		　　　　　　　　　　 ,.-‐'´　　　　　　　　　　　　　　ヽ、
		　　　　　　　　　,.:´　　　　　Y　　　　　　　　　　　　　ヽ、
		　　 　 　 　 　 /　　 　 　 　 i　　　　　　　　　　　　　 　 ＼
		.　　　　 　 　 .′　　　　　　 |　　 　 　 　 　 ∨　　　 　 　 .
		　 　 　 　 ,.イ　　　　　 　 　 !　　　　 　 　　　'､　　　　　　　　ヽ
		.　　　 　 .′　　　'.　　　　　 '.　　　　　　　　　 '. 　 /　 　 　 　 !
		　　　　　i 　 　 　 ﾍ　　　　　ﾍ　　　　　　　　 　'.　ｆ　 　 　　　 }
		　　　　　|　 　　　　ヽ　　　　　ヽ 　 　 　 　 　 　∨　 　 　 　 /｀
		. 　 　　 .′　 　 　 　 ヽ　　　　　＼　　　　　 　　ｊ 　 　 　　. ′
		　　　　 {　　 ＼　　　　　ヽ　　　　　＼　　　 　 ノ　　　　　/
		.　　　　 '.　　　 ＼　　　　　 ヽ 　　　　｀ ー‐ｧ'´　　 　 　 /
		　　　　　ヽ　　　　 ヽ 　　 　 　丶　　　 　／　　　　　 .:,.ｲ
		　　　 　 　 ＼　　　　丶 　　　　　` ｰ‐ｧ'´　　　　 　 ／
		　　　　　　 　 ＼　　　　 丶　　　　 ,.イ 　 　,..　-‐　´
		　　　　　　 　 　 ` ‐- 　 .,＿,.＞‐''´　`ｰ一'		 
		
		
		*/
		if (navigator.appName == 'Microsoft Internet Explorer'){

			setTimeout(function(){
					
				$('#modalPano').css('height', $('#modalLargeImage img').outerHeight());
				$('#modalPano').css('width', $('#modalLargeImage img').outerWidth());			
				google.maps.event.trigger(chartDemo.googlePanorama, 'resize');				
				$('#streetViewMetaHolder').css('visibility','visible');
				$('#modalPano').css('height', $('#modalLargeImage img').outerHeight());
				$('#modalPano').css('width', $('#modalLargeImage img').outerWidth());	
				$('#streetViewControlsStart').css('width', $('#modalLargeImage img').outerWidth());				
				$('#streetViewControlsEdit').css('width', $('#modalLargeImage img').outerWidth());				
				$('#streetViewControlsPresent').css('width', $('#modalLargeImage img').outerWidth());								
				$('#streetViewImageHolder').css('width', $('#modalLargeImage img').outerWidth()+5);													
									
				var remainder = 860 - $('#modalLargeImage img').outerWidth();
				$('#streetViewMetaHolder').css('width', remainder);
				
				
				$('#streetViewPresentSlider').css('width', $('#modalLargeImage img').outerWidth()/2);
				$('#streetViewPresentSliderHolder').css('width', $('#modalLargeImage img').outerWidth()/2);					
 
				
																	
								
			
			
			}, 30);




		}
		 
	
	
	
	
	},
	//end  	displayOpenDetailWindow
	

	//*********************************************************
	// Display/Load the images in the todo list
	//*********************************************************
	displyBuildTodoList: function(){	
	 
	   $('#todoBoxImages').empty();
	   $('#todoBoxImages').text('Loading Images');
	   
		$.get("http://thisismattmiller.com/chart/", { "toDoImages": true},
			function(data){				
				
				
				$('#todoBoxImages').text('');
				 
				var oldnotes = '';
				 
				for (aImage in data.results)
				{				
				
					var notes = chartDemo.utilityFilterNotesIntoTitle(data.results[aImage].notes);	

					if (oldnotes != notes){
						
						$('#todoBoxImages')
							.append(
								$("<div>")
									.text(notes)
									.addClass('todoBoxImagesHeader')
							
						);
					
						
						
					}
				
				
					$('#todoBoxImages')
						.append(
							$("<img>")
								.attr('src','img/' + data.results[aImage].museId + '_ring.png')
								.attr('height','70')
								.attr('width','70')
								.data('id',data.results[aImage].museId)
								.data('pano',data.results[aImage].pov)								
								.data('notes',data.results[aImage].notes)																						
								.mouseover(function() {
									
									
									
									
									var markerData = {dataId : $(this).data('id'), dataTitle: $(this).data('notes')};
									chartDemo.displayTogglePreviewImage(true,markerData);
									
									
									/*
									$('#previewBox').css('visibility','visible');										
									$('#previewBox').fadeIn('fast');

									$("#previewBoxImage").css('background-image','url(' + 'img/' + $(this).data('id') + '_medium.jpg'  + ')');
									$("#previewBoxTitle").text($(this).data('notes'));
									*/
									
									
									
								})
																		
			
						
						);
						
					oldnotes=notes;
				
				}
				$( "#todoBox img" ).draggable({ 
					cursorAt: { bottom : -5 },
					start:function(event, ui){ chartDemo.mapLockMarkers(); }, 
					stop: function(event, ui){	
					 
						//are we clear of the lightbox yet?
						if (chartDemo.markerClearkOfLightbox==false){return;}

						//store the data we are about to drop
						chartDemo.markerDataNotes = $(this).data('notes');
						chartDemo.markerDataId    = $(this).data('id');						
						chartDemo.markerDataIsNew = true;
						chartDemo.markerDataPano  = $(this).data('pano');

						$(this).remove();							
						//so Internet explore has a behavior that it does not track the lat/lng correctly when we are dragging
						//imgs out of the div over the map, but it does register just after you let go, so delay the action until
						//right after we left go of the img.

						setTimeout(function(){chartDemo.mapAddMarkerToCurrentPos();}, 10);
						 
						
					},
					helper: 'clone',
					scroll: false,
					appendTo: 'body'
				
				});				
				
				
				
				
				
		}, "json");		   
	 	
	
	},
	//end  	
	
	
	
	

	//*********************************************************
	//shows/hides markers on the map based on their folder
	//*********************************************************
	displayToggleListItem: function(useDom){	
	
		if ($(useDom).hasClass('liX')){
		
			//$(useDom).css('list-style-type','square');
			$(useDom).removeClass('liX');
			$(useDom).addClass('liCheck');			
			this.mapFilterMarkers($(useDom).data('title'),true);
			
		}else{

			//$(useDom).css('list-style-type','none');
			$(useDom).removeClass('liCheck');
			$(useDom).addClass('liX');						
			this.mapFilterMarkers($(useDom).data('title'),false);					
			
		}	 
	
	},
	//end  	displayToggleListItem
	
	
	
	//*********************************************************
	//makes all the calls to load the jquery interface
	//*********************************************************
	displayLoadJqueryUI: function(){	
	
		//MODALS
		//modal dialog box that holds the details
		//
		$( "#modalDetailDialog" ).dialog({
			height: 510,
			width:900,
			modal: true,
			autoOpen: false,
			close: function(event, ui) { 
				
				$('#streetViewControlsStart').css('display','block');
				$('#streetViewControlsEdit').css('display','none');						
				$('#streetViewControlsPresent').css('display','none');
				$('#modalPano').fadeTo('fast', 0);			
				chartDemo.googlePanorama.setVisible(false);			
				 
			}

		});			
		
		/////////////
		// SLIDERS //
		/////////////
		
		//controls the transparency of the present street view 
		$( "#streetViewPresentSlider" ).slider({				
			slide: function(event, ui) {			
				var value = $(this).slider( "option", "value" );				
				value=value/100;				
				$('#modalPano').fadeTo(1, value);
			},
			change: function(event, ui) {			
				var value = $(this).slider( "option", "value" );				
				value=value/100;				
				$('#modalPano').fadeTo(1, value);
			}		
		});		
		//controls the transparency of the edit street view slider, that is when the "Add google street view layer" button is click
		//so the first time we are adding a street view to the image
		$( "#streetViewEditSlider" ).slider({				
			slide: function(event, ui) {			
				var value = $(this).slider( "option", "value" );				
				value=value/100;				
				$('#modalPano').fadeTo(1, value);
			},
			change: function(event, ui) {			
				var value = $(this).slider( "option", "value" );				
				value=value/100;				
				$('#modalPano').fadeTo(1, value);
			}		
		});		
		
		
		
		///////////
		//BUTTONS//
		///////////
		
		
		//remvoes the marker and clear its loc data from the DB, in the detail edit window
		$( "#linkRemoveItem" ).click(function() {
			if (confirm("Are you sure you want to remove this from the map? All data will be remove.")){			
				$.get("http://thisismattmiller.com/chart/", { "removeItemFromMap": chartDemo.markerActive.dataId},
					function(data){									  
							  
							  //loop through the array and drop it out
								var arLen=chartDemo.allMarkers.length;

								for ( var i=0, len=arLen; i<len; ++i ){
									
									if (chartDemo.allMarkers[i].dataId==chartDemo.markerActive.dataId){	
										//remove from array and reset the array size
										chartDemo.allMarkers.splice(i, 1);
										len=chartDemo.allMarkers.length;
									}
								}								  
							  
							  chartDemo.markerActive.setMap(null); 
							  chartDemo.displyBuildTodoList();
	  		  				  $( "#modalDetailDialog" ).dialog("close"); 				
				}, "json");
			} 
		});		
		
		//shoes the note textbox
		$( "#linkAddNote" ).click(function() {			
			$('#addNoteHolder').fadeIn('fast');
			$('#addNoteHolder').css('display','block');			 
		});		
		
		
		//Adds a notes to the marker data
		$( "#addNoteButtonAdd" ).button({
			text: true
		})
		.click(function() {
			var note = $('#addNoteText').val();			
			note = encodeURIComponent(note);
			$.get("http://thisismattmiller.com/chart/", { "note": note, "id": chartDemo.markerActive.dataId},
				function(data){		
				  $('#addNoteText').val('');			  
				  $('#addNoteHolder').fadeOut('fast');			
			}, "json");				
		});			
		
		
		//the never mind button for adding a note to a record
		$( "#addNoteButtonNvm" ).button({
			text: true
		}).click(function() { 
			  $('#addNoteText').val('');			  
			  $('#addNoteHolder').fadeOut('fast'); 
		});				
		
		
		//the save view button when adjusting a new street view on a marker
		$( "#streetViewButtonSave" ).button({
			text: true
		})
		.click(function() {
			var pov = chartDemo.googlePanorama.getPov();			
			var latLng = chartDemo.googlePanorama.getPosition();	
			var povString = latLng.lat() + ',' + latLng.lng() + ',' +  pov.heading + ',' + pov.pitch + ',' + pov.zoom;		
			chartDemo.utilitySavePOV(chartDemo.markerActive.dataId,povString);
		});			
		
		//the never mind button for the add street view layer
		$( "#streetViewButtonNvm" ).button({
			text: true
		})
		.click(function() {			
			$('#modalPano').fadeTo('fast', 0);
			chartDemo.googlePanorama.setVisible(false);		
			$('#streetViewControlsStart').css('display','block');
			$('#streetViewControlsEdit').css('display','none');				
		});			
		
		
		//enable editing of the street view layer
		$( "#streetViewButtonAdd" ).button({
			text: true
		})
		.click(function() { 
			$('#streetViewControlsStart').css('display','none');
			$('#streetViewControlsEdit').css('display','block');			
			$( "#streetViewEditSlider" ).slider( "option", "value", 75 );
			$('#modalPano').fadeTo('fast', 0.75);
			chartDemo.googlePanorama.setVisible(true);
		});			
		
	 		
		
		//show the filter window
		$( "#buttonAdd" ).button({
			icons: {primary: "customIconAdd"}			 
		})
		.click(function() {
			
			if ($(this).is(':checked')){

				chartDemo.displyBuildTodoList();
				
				$('#previewBox').css('right','');					
				$('#previewBox').css('top','');	
								
				$('#previewBox').css('left','10px');					
				$('#previewBox').css('bottom','10px');	
								
				$('#todoBox').css('visibility','visible');
				$('#todoBox').show('slide', {direction: 'right'}, 700);							

											
			}else{

				$('#previewBox').css('left','');					
				$('#previewBox').css('bottom','');	

				$('#previewBox').css('right','10px');					
				$('#previewBox').css('top','10px');		
			
				//$('#filterBox').hide('slide', {direction: 'up'}, 700);
				$('#todoBox').hide('slide', {direction: 'right'}, 700);		
		
					
			}
			
			
			
		});		
				
		
		
		//show the filter window
		$( "#buttonFilter" ).button({
			icons: {primary: "customIconFilter"}
		})
		.click(function() {
			
			if ($(this).is(':checked')){
				$('#filterBox').css('visibility','visible');
				$('#filterBox').show('slide', {direction: 'up'}, 700,function() {});				
			}else{
				$('#filterBox').hide('slide', {direction: 'up'}, 700);
			}
			
			
			
		});			
		
			
		//show the search interface
		$( "#buttonSearch" ).button({
			icons: {primary: "customIconSearch"}
		})
		.click(function() {
			
			if ($(this).is(':checked')){
				$('#searchBox').css('visibility','visible');
				$('#searchBox').show('slide', {direction: 'up'}, 700,function() {$('#formSearch_text').focus(); $('#formSearch_text').select();});

			}else{
				$('#searchBox').hide('slide', {direction: 'up'}, 700);
			}
		});			
		
				 
				 
		//hide all in the fitler box
			
		$( "#filterBoxHideAll" ).click(function() {			
			 
			$('.filterListItem').each(function(index) { 

				//all
				if ($(this).hasClass('liCheck')){
					$(this).click();
				}

				//if ($(this).data('title').toLowerCase() == 'brooklyn residences'){
				
				//}
			
			
			});						
			 
			 
			 	 
		});							 
		

		  //minor hack for some fire fox bizzarness with page reloading
		  $('#buttonFilter').button('disable');
          $('#buttonSearch').button('disable');
          $('#buttonAdd').button('disable');	
		  		
		  $('#buttonFilter').button('enable');
          $('#buttonSearch').button('enable');
          $('#buttonAdd').button('enable');		
		   
		
		
		
		
		///////////////////
		// MISC UI Binds //
		///////////////////
		
		//when enter his hit on the search form		
		$('#formSearch').submit(function(event) {
	      chartDemo.utilitySearchMap();
		  event.stopPropagation();
		  return false;
		});		
				
		
		//fade out the preview image when the mouse leaves that holder div
		$('#todoBoxImages').mouseout(function() {
			$('#previewBox').fadeOut(10);
		});				
		
		


		//this keeps track of the mouse if it over the light box, to prevent mishaps with the drag and drop
		if (navigator.appName != 'Microsoft Internet Explorer'){
			$('#todoBox').mouseout(function() {chartDemo.markerClearkOfLightbox=true;});
			$('#todoBox').mouseover(function() {chartDemo.markerClearkOfLightbox=false;});		
			chartDemo.markerClearkOfLightbox=false;
		}else{
			//internet explorer thinks that even while dragging the dragged opbject is withing the lightbox DIV, FIXME			
			chartDemo.markerClearkOfLightbox=true;
		}		
		
		
	

		
		
	 
	
	},
	//end 	displayLoadJqueryUI
	
	
	
	
	
	
	//*********************************************************
	//
	//*********************************************************
	templateFunction: function(){	
	 
	
	}
	//end  
	
 
	
	
 
	
	
};







	//use jquery ready event to load things up

	$(document).ready(function(){ 
		
		
		//initialize the UI
		chartDemo.displayLoadJqueryUI();		
		
		//initialize google maps
		chartDemo.initializeGoogle();
		
		
		//load the markers already placed
		chartDemo.mapAddPlacedMarkers();
		
		
	});


</script>









<title>Chart Demo</title>
</head>



<body>


	<div id="map_canvas" style="width:100%; height:100%"></div>

    <span id="toolBar" class="ui-widget-header ui-corner-all">
    
	    <? /* <button id="buttonFilter">Filter Images</button>  
		
		        <button id="buttonAdd">Add Images To Map (<span id="toDoCount"></span>)</button>    

		        <button id="buttonSearch">Search For Location</button>

		
		*/ ?>
        
        
        <input type="checkbox" id="buttonFilter" /><label id="filterButtonHolder" title="Filter Images By Folder" for="buttonFilter"> &nbsp; </label>
        <input type="checkbox" id="buttonSearch" /><label id="searchButtonHolder" title="Search For Brooklyn Location" for="buttonSearch"> &nbsp; </label>

        <input type="checkbox" id="buttonAdd" /><label id="addButtonHolder" title="Add Images To The Map" for="buttonAdd"> &nbsp; </label>

       
        
   
    </span>
    
    <div id="searchBox" class="ui-widget-header ui-corner-all">
    
        
    <form id="formSearch" name="formSearch" action="/">
        <input type="text" id="formSearch_text" class="ui-corner-all" name="formSearch_text" value="Brooklyn Museum" />
    	<div>
        Enter a term and hit enter to search the Brooklyn Area. Try terms like:
        </div>
        <ul>
        	<li>Church and Bedford Ave</li>
        	<li>Brooklyn Heights</li>            
        	<li>Lefferts House</li>                        
        	<li>40.658266, -73.968351</li>                                    
        </ul>
        
        
     </form>
     </div>
    

    <div id="filterBox" class="ui-widget-header ui-corner-all">
    	
        
        <span id="filterBoxHideAll">Hide All</span>
        <ul id="filterBoxTitleList">
        
        
        </ul>
        
        
 
     </div>

	<div id="todoBox" class="ui-widget-header ui-corner-all"> 
    	<div class="todoBoxInstruction">
        	Click and Drag to place an image on the map. Don't worry, once placed it can be re-adjusted! 
        </div>    
        <div id="todoBoxImages"></div>
     
    
    </div>
    
    <div id="previewBox" style="top:10px; right:10px;">
    	<div id="previewBoxImage"></div>
        <div id="previewBoxTitle"></div>
    </div>
    
    

<div id="modalDetailDialog" title="Past and Present" style="padding:.5em 0.5em">
	
    <div id="streetViewImageHolder" style="float:left;">
		<div id="modalLargeImage"></div>
        <div id="modalPanoHolder">

        </div>
        
        <div id="streetViewControlsStart" style="text-align:center;">
        	<button style="font-size:0.75em; margin-top:5px;" id="streetViewButtonAdd">Add Google Street View Layer</button>
        </div>
        
        <div id="streetViewControlsEdit">
        
        	<div style="float:left; margin-top:5px;"><button style="font-size:0.75em" id="streetViewButtonSave">Save View</button></div>
        	<div style="float:left; margin-top:5px;"><button style="font-size:0.75em" id="streetViewButtonNvm">Never Mind</button></div>
        	<div style="float:right; width:280px; height:35px; position:relative; margin-right:5px;">
            
            
            	<div id="streetViewEditSlider" style="margin-top:5px;" ></div>
            
            	<span>Past</span>
            	<span style="position:absolute; right:0px">Present</span>                
            
            	
            
            </div>                        
        	

        
        </div>        	
        <div id="streetViewControlsPresent">
        	<div id="streetViewPresentSliderHolder" style="height:35px; position:relative; margin-right:auto; margin-left:auto;">

        	
		        <div id="streetViewPresentSlider" style="margin-top:5px;" ></div>
            	<span>Past</span>
            	<span style="position:absolute; right:0px">Present</span>                
                

                
                
                
                
            </div>
	        
        </div>	        
        
    </div>
    
    
    
    <div id="streetViewMetaHolder">
    
    	<div id="streetViewTitle"></div>
        
        <div id="streetViewNotes"></div>

				<div id="streetViewNotesHolder"></div>

                <div id="addNoteHolder">
                
                	<textarea id="addNoteText" style="height:200px; width:97%;">Enter Note Here</textarea>
                    <button style="font-size:0.75em" id="addNoteButtonAdd">Add Note</button>
                    <button style="font-size:0.75em" id="addNoteButtonNvm">Never Mind</button>
                    
                
                </div>    
    
    	<a id="linkAddNote" style="position:absolute; text-decoration:none; bottom:0px; font-size:14px; left:0px" href="#">Add Note</a>&nbsp;<?php /* <a style="position:absolute; text-decoration:none; right:0px; bottom:0px; font-size:14px;" id="linkRemoveItem" href="#">Remove From Map</a> */ ?>
    	
        <div id="userImagesHolder"><span>hello</span></div>
        
    </div>
    
    
</div>


</body>




</html>
